<!DOCTYPE html>
<html ng-app>
<head>
    <style>

        * {
            font-family: sans-serif;
        }

        ul {
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            text-align: left;
        }
        li {
            width: 40px;
            padding-left: 5px;
            padding-right: 5px;
            display: inline-block;
            vertical-align: top;
            text-align: center;
            background-color: #99DDBB;
            border: 1px solid #000000;
            border-radius: 15px;
        }

        .fretBoard {
            font-size: 95%;
            display: table;
            margin-left: 50px;
        }

        .string {
            display:table-row;
            background-color: rgba(255, 205, 178, 0.13);
        }
        .spot {
            position: relative;
            display: inline-block;
            width: 32px;
            height: 25px;
            margin: -2px 0 -2px 0;
            border: 1px solid #92b2d5;
        }

        .openMarker {
            background-color: rgba(238, 189, 161, 0.20);
            border-right: 3px solid #92b2d5;
        }

        .marker {
            background-color: rgba(251, 202, 172, 0.15);
        }

        .spotText {
            position:absolute;
            width: 25px;
            margin: 4px 0 0px 6px;
        }

        .played {
            position: absolute;
            width: 25px;
            margin: 3px 2px 0px 2px;
            background-color: rgba(146, 178, 213, 0.32);
            border: 1px solid #92b2d5;
            border-radius: 12px;
        }

        .cmdButton {
            width: 40px;
            border: 1px solid #92b2d5;
            padding: 4px 4px 4px 8px;
            margin-bottom: 12px;
            background-color: rgba(146, 178, 213, 0.32);
        }

    </style>
    <script src="public/lib/angular/angular.js"></script>
    <script>

/////////////////////////////////////////////////////////////
// Constants

var stringLength = 17

var intNames =
    ['1','b9','9','b3','3','4','b5','5','#5','6','b7','7']

var noteNames =
    [
        {flat: 'C', sharp:'C'},
        {flat: 'Db', sharp:'C#'},
        {flat: 'D', sharp:'D'},
        {flat: 'Eb', sharp:'D#'},
        {flat: 'E', sharp:'E'},
        {flat: 'F', sharp:'F'},
        {flat: 'Gb', sharp:'F#'},
        {flat: 'G', sharp:'G'},
        {flat: 'Ab', sharp:'G#'},
        {flat: 'A', sharp:'A'},
        {flat: 'Bb', sharp:'A#'},
        {flat: 'B', sharp:'B'}
    ]


//////////////////////////////////////
// instrument Definitions

var guitar = {
    name: 'Guitar',
    openStrings: [4, 11, 7, 2, 9,  4]
}

var fiddle = {
    name: 'Fiddle',
    openStrings: [4, 9, 2, 7]
}

var ukulele = {
    name: 'Ukulele',
    openStrings: [9, 4, 0, 7]
}

var bass = {
    name: 'Bass',
    openStrings: [7, 2, 9, 4]
}

var dobro = {
    name: 'Dobro',
    openStrings: [2, 11, 7, 2, 11, 7]
}

////////////////////////////////////////////////////////
// Get a fretboard

        function getFretboard (theInstrument) {

            var fretboard = {
                flats: true,
                key: "C",
                instrument: theInstrument,
                strings: []
            }

            fretboard.clearPlayed = function() {
                fretboard.strings.forEach(function(theString) {
                    theString.forEach(function(theSpot) {
                        theSpot.played = false
                    })
                })
            }

            fretboard.toggleAllLikeSpots = function(clickedSpot) {
                var wasPlayed = clickedSpot.played
                fretboard.strings.forEach(function(theString) {
                    theString.forEach(function(theSpot) {
                        if (theSpot.note === clickedSpot.note) {
                            theSpot.played = !wasPlayed
                        }
                    })
                })
            }

            // Init all the strings on the fretboard.
            // This is the first and last time the spots and strings are layed out.
            // Markers never change
            for (var i=0; i<fretboard.instrument.openStrings.length; i++) {
                var string = []
                for (var j=0; j<stringLength; j++) {
                    var spot = {}
                    if (j == 0) {
                        spot.openMarker = true
                    }
                    else if([5, 7, 9, 12].indexOf(j) !== -1) {
                        spot.marker = true
                    }
                    string.push(spot)
                }
                fretboard.strings.push(string)
            }

            fretboard.setKey = function(theKey) {
                fretboard.key = theKey
                if (theKey == 'C') {
                    fretboard.flats = true
                }
                else if (theKey.indexOf('b') !== -1) {
                    fretboard.flats = true
                }
                else {
                    fretboard.flats = false
                }
            }

            fretboard.setSpotsText = function() {
                fretboard.strings.forEach(function(theString) {
                    theString.forEach(function(theSpot) {
                        theSpot.text = 'l'
                    })
                })
            }

            fretboard.setSpotsText()

            return fretboard


            function getString(stringNum) {
                var string = [];
                var ptr = fretboard.instrument.openStrings[stringNum];
                for (var i=0; i<stringLength; i++) {
                    var spotNoteName = fretboard.flats ? noteNames[ptr].flat : noteNames[ptr].sharp
                    var spot = {note: spotNoteName, text: spotNoteName, played: false}

                    if (i == 0) {
                        spot.openMarker = true
                    }
                    else if([5, 7, 9, 12].indexOf(i) > -1) {
                        spot.marker = true
                    }
                    string.push(spot)
                    ptr++
                    if (ptr > 11) {
                        ptr = 0
                    }
                }
                return string
            }

//            function prepSpot()
        }


//////////////////////////////////////////////////////////////////////////////
// Controller

        function FretsController($scope) {

            $scope.fretboard = getFretboard(guitar)

            $scope.checked = true

            $scope.clicked = function(spot) {
                $scope.fretboard.toggleAllLikeSpots(spot)
            }
        }
    </script>
</head>

<body>

<div ng-controller="FretsController">

    <br>

    <form>
        <input type="checkbox" ng-model="checked">
        <input type="submit" ng-click="clicked()"/>
    </form>

<br><br>
 {{instrument.name}}
 <br>
 <br>
    <div class="fretBoard">
        <div class="cmdButton" ng-click="fretboard.clearPlayed()">clear</div>
        <div class="string" ng-repeat="string in fretboard.strings">
            <div class="spot" ng-repeat="spot in string"
                 ng-class="{openMarker:spot.openMarker, marker:spot.marker}" >
                <div  ng-show="spot.played" class="played">
                   &nbsp;
                </div>
                <div class="spotText" ng-click="clicked(spot)">
                    {{spot.text}}
                </div>
            </div>
        </div>
    </div>

</div>

</body>
</html>